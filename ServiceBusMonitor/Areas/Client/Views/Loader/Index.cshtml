@using ServiceBusMonitor.Areas.Api.Models
@{
    ViewData["Title"] = "Loading the Service Bus Monitor";
}

<div class="container">
    <div class="row">
        <div class="col-lg-12 my-5 py-5">
            <div class="card mt-5 rounded">
                <div class="card-body">
                    <div class="float-left float-none-xs">
                        <div class="d-inline-block text-center py-5">
                            <img src="~/img/logo.png" alt="Service Bus Monitor" class="w-25">
                            <h5 id="status-message" class="py-4">Starting the Service Bus Monitor...</h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var checkStatus = function() {
        $.get("/api/ApplicationLoader/Status", function(data) {
            processStatus(data);
        });
    };

    var processStatus = function(data) {
        var targetHolder = $('#status-message');
        if (targetHolder.text() !== data.status) {
            targetHolder.fadeOut(250, function() {
                targetHolder.removeClass('text-warning');
                targetHolder.removeClass('text-danger');
                targetHolder.text(data.status);
                targetHolder.fadeIn(250);
            });
        }

        if (data.redirectUri !== "") {
            document.location = data.redirectUri;
        } else if (data.loaderStatusType === @((int)LoaderStatusType.Warning)) {
            targetHolder.addClass('text-warning');
        } else if (data.loaderStatusType === @((int)LoaderStatusType.Error)) {
            targetHolder.addClass('text-danger');
        } else {
            setTimeout(function() {
                checkStatus();
            }, 500);
        }
    };

    windowload.push(function() {
        $.get("/api/ApplicationLoader", function(data) {
            processStatus(data);
        });

        checkStatus();
    });
</script>